#!/bin/bash

echo "Starting restore process..."

RESTORE_DIR="../Backup/"

# 1. Restore .config and .local/share
read -p "This will overwrite your current ~/.config and ~/.local/share. Do you want to proceed? (y/N): " CONFIRM_RESTORE_FILES
if [[ "$CONFIRM_RESTORE_FILES" =~ ^[Yy]$ ]]; then
    echo "Restoring ~/.config..."
    rsync -a --delete "$RESTORE_DIR/.config/" "$HOME/.config/" || { echo "Error: Could not restore ~/.config."; rm -rf "$RESTORE_DIR"; exit 1; }
    echo "Restoring ~/.local/share..."
    rsync -a --delete "$RESTORE_DIR/.local/share/" "$HOME/.local/share/" || { echo "Error: Could not restore ~/.local/share."; rm -rf "$RESTORE_DIR"; exit 1; }
else
    echo "File restoration skipped."
fi

# 2. Install Pacman packages
PACMAN_PACKAGES_FILE="$RESTORE_DIR/pacman_packages.txt"
if [ -f "$PACMAN_PACKAGES_FILE" ]; then
    read -p "This will install/reinstall Pacman packages. Do you want to proceed? (y/N): " CONFIRM_INSTALL_PACMAN
    if [[ "$CONFIRM_INSTALL_PACMAN" =~ ^[Yy]$ ]]; then
        echo "Installing Pacman packages..."
        sudo pacman -S --needed - < "$PACMAN_PACKAGES_FILE" || { echo "Error: Could not install Pacman packages."; rm -rf "$RESTORE_DIR"; exit 1; }
    else
        echo "Pacman package installation skipped."
    fi
else
    echo "Pacman package list not found in backup."
fi

# 3. Install AUR packages
AUR_PACKAGES_FILE="$RESTORE_DIR/aur_packages.txt"
if [ -f "$AUR_PACKAGES_FILE" ]; then
    read -p "This will install/reinstall AUR packages using yay. Do you want to proceed? (y/N): " CONFIRM_INSTALL_AUR
    if [[ "$CONFIRM_INSTALL_AUR" =~ ^[Yy]$ ]]; then
        echo "Installing AUR packages..."
        yay -S --needed - < "$AUR_PACKAGES_FILE" || { echo "Error: Could not install AUR packages. Make sure yay is installed."; rm -rf "$RESTORE_DIR"; exit 1; }
    else
        echo "AUR package installation skipped."
    fi
else
    echo "AUR package list not found in backup."
fi

echo "Restore process complete!"
